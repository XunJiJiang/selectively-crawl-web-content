# selectively-crawl-web-content

## 项目简介

本项目用于“选择性抓取网页内容”，由前端油猴脚本（React/Vite/TypeScript）和 Node 服务端（Express）组成。支持在任意网页上通过悬浮窗选择、管理、抓取页面元素内容，并将结果上传到本地服务器保存为 JSON。

---

## 功能特性

- 油猴脚本悬浮窗，支持拖动、收起、展开、位置记忆。
- 元素选择与高亮。
- 每项可设置“前缀”。
- 抓取结果通过 POST 上传本地 Node 服务，服务端自动写入指定 JSON 文件（二维数组结构）。
- UI 风格统一，深灰/浅灰，圆角，按钮/输入框/拖动手柄均美观易用。
- 交互细节持续优化，支持撤回、父级切换、状态持久化。

---

## 快速使用

### 1. 安装依赖

```bash
npm i
pnpm i
bun i
```

### 2. 启动服务端

1. 配置保存路径：编辑 `server/config/config.json`，设置 `save-in` 为目标 json 文件绝对路径。

   > [!INFO]
   > 如果文件不存在，则会自动创建。
   >
   > 如果文件存在，但根元素不是数组(包括空文件)，则不会写入。但浏览器控制台会认为已经传输到本地。

2. 启动服务：

   ```bash
   npm start
   pnpm run start
   bun start
   ```

   服务默认监听 <http://localhost:3100/save>

### 3. 构建并安装油猴脚本

1. 构建脚本：

   ```bash
   bun run build
   # 生成 dist/vite-project.user.js
   ```

2. 在油猴/Violentmonkey/GreaseMonkey 中新建脚本，粘贴 `dist/vite-project.user.js` 内容。

### 4. 网页端使用

- 打开任意网页，左上角出现悬浮窗。
- 点击“选择”按钮，高亮光标定位的元素，点击选中元素。
- 填写描述，点击“确认”加入表单。
- 加入表单后，可修改前缀，例如修改为 `#`。
- 支持多项管理、拖拽排序、删除。
- 点击“抓取”按钮，内容将上传到本地服务端。

### 5. 保存的数据结构

#### 数据结构举例

假设你在网页上抓取两个个元素：

```html
<h1>我是标题</h1>

<div>我是标签<span>猫</span><span>狗</span></div>
```

设置第一个元素标签为空(会默认设置为`<null>`)，前置为空；

设置第二个元素标签为`标签`，前置为 `@`；

则服务端保存的 json 文件内容如下：

```json
[
  [
    { "label": "<null>", "value": "我是标题" },
    { "label": "标签", "value": "@我是标签 @猫 @狗" }
  ]
]
```

每次点击“抓取”按钮，都会将当前表单区所有项作为一个数组整体追加到文件，形成二维数组结构。

> [!WARNING]
> 注意，选择的元素会在向服务端发送请求时进行扁平化处理，并为每一段文本元素前都添加前置

---

## 配置说明

- 服务端保存路径：`server/config/config.json`，如：

  ```json
  { "save-in": "/Users/xxx/save-in-here.json" }
  ```

- 前端本地存储：表单项、窗口位置、展开状态均自动持久化。

---

## 常见问题

- **端口冲突**：如默认的 3100 端口被占用，可修改 .env 中 `PORT`。

---

## 开发&自定义

- 脚本源码：`user-script/src/`，基于 React+Vite。
- 服务端源码：`server/index.ts`，基于 Express。
- 构建命令、依赖见 `package.json`。

---

## 贡献&反馈

如有建议、bug 或新需求，欢迎提 issue 或直接联系作者。

---

## 免责声明

本项目仅供学习与技术交流使用，严禁用于任何违反法律法规或侵犯他人权益的用途。因使用本项目产生的任何后果，均由使用者本人承担，作者不承担任何法律责任。

---

## License

项目采用 [MIT License](./LICENSE) 开源许可，详情请查阅 LICENSE 文件。
